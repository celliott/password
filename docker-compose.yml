version: "3"
services:
  certbot:
    image: ${ORGANIZATION}/${CONTAINER}:${BUILD_TAG}
    environment:
      - DOMAIN=${DOMAIN}
      - EMAIL=${EMAIL}
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - letsencrypt:/etc/letsencrypt

  auth-proxy:
    build: ./docker/auth-proxy
    image: ${ORGANIZATION}/auth-proxy:${BUILD_TAG}
    restart: always
    environment:
      - AUTH_USER=${AUTH_USER}
      - AUTH_PASS=${AUTH_PASS}
    ports:
      - "80:80"
      - "443:443"
    networks:
      - overlay
    volumes:
      - letsencrypt:/etc/letsencrypt

  password:
    build: ./docker/password
    image: ${ORGANIZATION}/${CONTAINER}:${BUILD_TAG}
    container_name: ${CONTAINER}
    restart: always
    ports:
      - "3000:3000"
    networks:
      - overlay

volumes:
  letsencrypt:

networks:
    overlay:
